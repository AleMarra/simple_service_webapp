<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <style>
        label {
            display: inline-block;
            width: 80px;
        }
    </style>
<script>

	function getXMLDoc(url) {
		var httpRequest;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			httpRequest = new XMLHttpRequest();
		} else {// code for IE6, IE5
			httpRequest = new ActiveXObject("Microsoft.httpRequest");
		}
		httpRequest.onreadystatechange = function() {
			if (httpRequest.readyState == 4 && httpRequest.status == 200) {

				console.log(httpRequest.responseText);
				
				xmlDoc = httpRequest.responseXML;

				document.getElementById('User').innerHTML = xmlDoc
						.getElementsByTagName("user")[0].childNodes[0].nodeValue;
				document.getElementById('Name').innerHTML = xmlDoc
						.getElementsByTagName("fullName")[0].childNodes[0].nodeValue;
				document.getElementById('ID').innerHTML = xmlDoc
						.getElementsByTagName("id")[0].childNodes[0].nodeValue;
			}
		}
		httpRequest.open("GET", url, true);
		httpRequest.send();
	}

	function getJSON(url,fieldID,fieldName,fieldUser) {
		var httpRequest;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			httpRequest = new XMLHttpRequest();
		} else {// code for IE6, IE5
			httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
		}
		httpRequest.onreadystatechange = function() {
			
			if (httpRequest.readyState == 4) {

				 if (httpRequest.status != 200){
					document.getElementById('statusError').innerHTML = httpRequest.status;
					document.getElementById('messageError').innerHTML = httpRequest.responseText;
						
				}else{
					 
					console.log(httpRequest.responseText);
					// Javascript function JSON.parse to parse JSON data
					var jsonObj = JSON.parse(httpRequest.responseText);
	
					// jsonObj variable now contains the data structure and can
					// be accessed as jsonObj.name and jsonObj.country.
					document.getElementById(fieldUser).innerHTML = jsonObj.user;
					document.getElementById(fieldName).innerHTML = jsonObj.fullName;
					document.getElementById(fieldID).innerHTML = jsonObj.id;
					
					document.getElementById('status').innerHTML = httpRequest.status;
				}
			}
		}
		
		httpRequest.open("GET", url, true);
		httpRequest.send();
	}
	
	function postJSON(url) {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

				console.log(xmlhttp.responseText);
				// Javascript function JSON.parse to parse JSON data
				var jsonObj = JSON.parse(xmlhttp.responseText);

				// jsonObj variable now contains the data structure and can
				// be accessed as jsonObj.name and jsonObj.country.
				document.getElementById('UserPosted').innerHTML = jsonObj.user;
				document.getElementById('NamePosted').innerHTML = jsonObj.fullName;
				document.getElementById('IDPosted').innerHTML = jsonObj.id;
			}
		}

		xmlhttp.open("POST", url);
		xmlhttp.setRequestHeader("Content-Type", "application/json");
		xmlhttp.send(JSON.stringify({id:5, user:"myUser", fullName:"myFullName"}));
	}
    /*
     Usage: receives the id of the DOM element whose inner elements defines the request through
     a class name convention:
     url: the URL for the request. Appended to 'api/'
     type: HTTP verb. Defaults to 'GET'
     url-param: mandatory parameters of the request, such us user id when using getUser. Appended to the URL
     query-string: optional parameters of the request. Also, a 'param-name' attribute at the element is needed
     data: body of the request. 'param-name' attribute at the element is needed

     url-param, query-string and data elements should be inputs or have a val attribute.

     Although this is our sandbox and nothing here is to be delivered, improvements and suggestions are appreciated.
     */
    function sendRequest(idType) {
        var $el = $("#" + idType),
            url = 'api/',
            type = 'GET',
            data = {};
        // DOM $elements
        var $url = $el.find('.url'),
            $type = $el.find('.type'),
            $urlParams = $el.find('.url-params'),
            $queryString = $el.find('.query-string'),
            $data = $el.find('.data');

        function getVal ($el) {
            if ($el.prop("tagName") === 'INPUT')
                return $el.val();
            else if ($el.attr('val'))
                return $el.attr('val');
            else
                return '';
        }

        function appendAutodeletableMsg(msg, color) {
            var id = Math.random().toString(36).substring(2, 12);
            $el.append('<h4 id="'     +
                    id                +
                    '"style="color: ' +
                    color             +
                    ';">'             +
                    msg               +
                    '</h4>');
            setTimeout( function () {
                $('#' + id).remove();
            }, 5000);
        }

        function parseData($el) {
            var key = $el.attr('param-name'),
                val = getVal($el);

            if (key !== '' && val !== '')
                data[key] = val;
        }

        // Scrapping begins
        if ($url[0])
            url += getVal($url);

        if ($type[0])
            type = getVal($type);

        $urlParams.each( function (idx) {
            var $el = $urlParams.eq(idx),
                    value = getVal($el);

            if (value !== '')
                url += '/' + value;
        });

        $queryString.each( function (idx) {
            parseData($queryString.eq(idx));
        });

        $data.each( function (idx) {
            parseData($data.eq(idx));
        });

        // AJAX request!
        $.ajax({
            url: url,
            type: type,
            data: data,
            error: function (jqXHR, textStatus, errorThrown ) {
                appendAutodeletableMsg('Se rompió todo :D', 'red');
                console.log(jqXHR);
                console.log(textStatus);
                console.log(errorThrown);
            },
            success: function (data, textStatus, jqXHR) {
                appendAutodeletableMsg('Salió bien :D', 'blue');
                console.log(data);
                console.log(textStatus);
                console.log(jqXHR);
            }
        })
    }
    
	</script>
</head>
<body>

<section id="registeruser">
    <h2>registeruser test</h2>
    <div class="registeruser">
        <div   class="url" val="registeruser" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <label>Usuario:</label>    <input class="data" param-name="username" type="text" /><br>
        <label>Contraseña:</label> <input class="data" param-name="password" type="password" ><br>
        <label>Nombre:</label>     <input class="data" param-name="nombre" type="text" /><br>
        <label>Apellido:</label>   <input class="data" param-name="apellido" type="text" /><br>
        <label>Padrón:</label>     <input class="data" param-name="padron" type="text" /><br>
        <label>FechaNac:</label>   <input class="data" param-name="fechaNac" type="date" /><br>
        <label>Email:</label>      <input class="data" param-name="email" type="text" /><br>
        <label>Rol:</label>        <input class="data" param-name="rol" type="number" /><br>

        <button onclick="sendRequest('registeruser')">Register</button>
    </div>
</section>

<section id="login">
    <h2>login test</h2>
    <div class="login">
        <div   class="url" val="registeruser" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <label>Usuario:</label>    <input class="data" param-name="username" type="text" /><br>
        <label>Contraseña:</label> <input class="data" param-name="password" type="password" ><br>
        <button onclick="sendRequest('login')">Login</button>
    </div>
</section>

<section id="logout">
    <h2>logout test</h2>
    <div class="logout">
        <div   class="url" val="logout" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('logout')">Logout</button>
    </div>
</section>

<section id="activateUser">
    <h2>activateUser test (@todo)</h2>
    <div class="activateUser">
        <div   class="url" val="activateUser" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('activateUser')">Activate</button>
    </div>
</section>

<section id="changePassword">
    <h2>changePassword test (@todo)</h2>
    <div class="changePassword">
        <div   class="url" val="changePassword" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('changePassword')">Change</button>
    </div>
</section>

<section id="resetPassword">
    <h2>resetPassword test (@todo)</h2>
    <div class="resetPassword">
        <div   class="url" val="resetPassword" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('resetPassword')">Reset</button>
    </div>
</section>

<section id="disableAccount">
    <h2>disableAccount test (@todo)</h2>
    <div class="disableAccount">
        <div   class="url" val="disableAccount" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('disableAccount')">Disable</button>
    </div>
</section>

<section id="enableAccount">
    <h2>enableAccount test (@todo)</h2>
    <div class="enableAccount">
        <div   class="url" val="enableAccount" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('enableAccount')">Enable</button>
    </div>
</section>

<section id="enableAccountFromEmaill">
    <h2>enableAccountFromEmail test (@todo)</h2>
    <div class="enableAccountFromEmaill">
        <div   class="url" val="enableAccountFromEmaill" style="display: hidden;"/>
        <div   class="type" val="POST" style="display: hidden;"/>
        <button onclick="sendRequest('enableAccountFromEmaill')">Enable</button>
    </div>
</section>
    
</body>
</html>
